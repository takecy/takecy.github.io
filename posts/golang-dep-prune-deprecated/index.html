<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css">
<link rel="stylesheet" href="https://takecy.github.io/css/normalize.css">
<link rel="stylesheet" href="https://takecy.github.io/css/skeleton.css">
<link rel="stylesheet" href="https://takecy.github.io/css/octicons/octicons.css">
<link rel="stylesheet" href="https://takecy.github.io/css/elegants/style.css">
<link rel="stylesheet" href="https://takecy.github.io/css/custom.css">
<link rel="alternate" href="https://takecy.github.io/index.xml" type="application/rss+xml" title="blog &lt;- takecy">
<title>Goの依存関係管理ツールのdepのpruneがdeprecatedになった - blog &lt;- takecy</title>
</head>
<body>

<div class="container">

	<header role="banner">
		
		
	</header>

	
		<div class="row back_top">
			<h4 class="two column"><a href="https://takecy.github.io/">&lt; Top</a></h4>
		</div>
	
	<div class="hr"></div>


	<main role="main">
		<article itemscope itemtype="http://schema.org/BlogPosting">
			<h1 class="entry-title" itemprop="headline">Goの依存関係管理ツールのdepのpruneがdeprecatedになった</h1>
			<span class="entry-meta"><time itemprop="datePublished" datetime="2018/02/03">2018/02/03</time></span>
			<section>
				 <a href="https://takecy.github.io/tags/docker">[ docker ]</a>  <a href="https://takecy.github.io/tags/golang">[ golang ]</a> 
			</section>
			<section itemprop="entry-text">
				

<p><br/>
Goの依存関係管理には<a href="https://github.com/golang/dep">dep</a>がデファクトだし、使っているのだが、
最近 <code>prune</code> コマンドがdeprecatedされた。</p>

<h3 id="depのprune">depのprune</h3>

<pre><code class="language-shell">$ dep prune -v
</code></pre>

<p>このコマンドは、<code>ensure</code> で山盛り追加されるvendorから、使用していないpackageを除外してくれて、レポジトリが軽くなるので気に入ってよく使っていた。
Makefileにもだいたい以下のように書いていた。</p>

<pre><code class="language-makefile">update:
    dep ensure -update -v &amp;&amp; dep prune -v
</code></pre>

<h3 id="実行時に警告が">実行時に警告が</h3>

<p>多分0.4からこういう警告が出るようになった。</p>

<pre><code>Pruning is now performed automatically by dep ensure.
Set prune settings in Gopkg.toml and it it will be applied when running ensure.

This command currently still prunes as it always has, to ease the transition.
However, it will be removed in a future version of dep.

Now is the time to update your Gopkg.toml and remove `dep prune` from any scripts.
</code></pre>

<p>意訳</p>

<pre><code>dep ensureで自動でできるようになったよ。
そのためにはtomlに設定を追加してね。

このコマンドは将来消すよ。
君のスクリプトから dep prune を今すぐ消すんだ！
</code></pre>

<h3 id="対応">対応</h3>

<ol>
<li>dep pruneを消す<br /></li>
<li>Gopkg.toml の先頭に以下を追加する。</li>
</ol>

<pre><code class="language-toml">[prune]
  non-go = true
  unused-packages=true
  go-tests=true
</code></pre>

<p>これでensure時に自動prune！</p>

<p><a href="https://golang.github.io/dep/docs/Gopkg.toml.html#prune">dep document</a></p>

<p>ちなみに、このdepのドキュメントは多分、Facebookの<a href="https://docusaurus.io/">docusaurus</a>製。</p>

			</section>
		</article>
	</main>


	<footer role="contentinfo">
		<div class="hr"></div>
		<div class="row">
			<div class="footer-link">
				<a href="https://github.com/takecy/" title="github"><span class="octicon octicon-mark-github"></span></a>
				<a href="https://twitter.com/takkecy" title="github"><span class="fs1" data-icon="&#xe094;"></span></a>
				<a href="https://takecy.github.io/index.xml" title="rss"><span class="octicon octicon-rss"></span></span></a>
			</div>
		</div>
		<div class="row">
			<div class="copyright">&copy; takecy</div>
			<div class="poweredby">by <a href="https://gohugo.io/">Hugo</a></div>
		</div>
	</footer>

</div>

<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-65880489-1', 'auto');
	ga('send', 'pageview');
</script>

<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>


<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<link rel="stylesheet" href="https://takecy.github.io/css/normalize.css">
<link rel="stylesheet" href="https://takecy.github.io/css/skeleton.css">
<link rel="stylesheet" href="https://takecy.github.io/css/octicons/octicons.css">
<link rel="stylesheet" href="https://takecy.github.io/css/elegants/style.css">
<link rel="stylesheet" href="https://takecy.github.io/css/custom.css">
<link rel="alternate" href="https://takecy.github.io/index.xml" type="application/rss+xml" title="blog &lt;- takecy">
<title>Go言語の依存パッケージ管理の闇 - blog &lt;- takecy</title>
</head>
<body>

<div class="container">

	<header role="banner">
		
		
	</header>

	
		<div class="row back_top">
			<h4 class="two column"><a href="https://takecy.github.io/">&lt; Top</a></h4>
		</div>
	
	<div class="hr"></div>


	<main role="main">
		<article itemscope itemtype="http://schema.org/BlogPosting">
			<h1 class="entry-title" itemprop="headline">Go言語の依存パッケージ管理の闇</h1>
			<span class="entry-meta"><time itemprop="datePublished" datetime="2015/08/16">2015/08/16</time></span>
			<section itemprop="entry-text">
				

<p>複数人で開発している場合、各メンバーのローカル環境が揃っていることは重要なこと。<br />
OSや言語のランタイムのバージョンはもちろんだけど、
依存しているパッケージのバージョンを同じにしておくことは重要。<br />
俺はテスト通ってるけどTravisさんでは通らないとかマジいらっとするし、
バグった時の再現性とかもろもろ問題が出てくるので、環境の同期は重要。</p>

<p>例えば、JavaではMaven+pom.xmlやGradle+build.gradle、Nodeならnpm+package.jsonなところを、
Goではどうやるんだっていう話。</p>

<h3 id="goで依存パッケージを取得する">Goで依存パッケージを取得する</h3>

<pre><code> go get github.com/google/go-github/github
</code></pre>

<p>以上。<br />
 簡単。これは捗る！<br />
 と思いきや、実際の開発ではいろいろ問題が発生する。</p>

<h3 id="バージョンいくつなんだよ問題">バージョンいくつなんだよ問題</h3>

<p>Goは、パッケージ取得の仕組み(<code>go get hoge/hoge</code> のこと)は言語レベルで存在するが、
パッケージの列挙とバージョンを管理する仕組みは存在しない。<br />
「このプロジェクトで使われているパッケージはA(ver0.9)とB(ver1.2)である。」<br />
というのを表現する方法は<strong>無い</strong>。<br />
よって各メンバーが、README等をみながら、</p>

<pre><code>go get A
go get B
go get C
...
</code></pre>

<p>をぽちぽちやらなくてはいけない。<br />
また、go get したタイミングによっては依存しているパッケージの別のバージョンが入ってしまう。<br />
なんてったって、go get にはバージョンを<strong>指定しない</strong>のだから、何が落ちてきてるのかわからん。<br />
Goの思想としては常に最新バージョン使おうぜ、ということらしいが、
そのことと、メンバー間の環境の同期はまた別の話だよね。</p>

<h3 id="別のプロジェクトでも使ってる問題">別のプロジェクトでも使ってる問題</h3>

<p>Goのプロジェクトとして、AとBがあって、両方でパッケージKを使ってるとする。<br />
「AではK:ver1.1.2を使って、BではK:ver1.1.3を使う」
ということは<strong>できない</strong>。<br />
GOPATHをそれぞれで設定しておいて、いじるときにいちいち切り替えれば出来るんだろうけど、
基本的にはGOPATHは一個だけ設定するのが良いとされているので、AとBは同じバージョンのKを参照せざるを得なくなる。<br />
これは辛い。。</p>

<h3 id="godep">Godep</h3>

<p>そこで登場するのがプロジェクト毎に依存関係を指定、管理できるツール、<a href="https://github.com/tools/godep">Godep</a>。<br />
安心のGithub製。<br />
そのプロジェクトで使っているパッケージとバージョン(正確にはコミットsha)を</p>

<pre><code>godep save ./...
</code></pre>

<p>で記録(その時点のスナップショット的な感じ)できる。<br />
新しく <code>Godeps</code> と <code>Gedeps/_workspace</code> というディレクトリと、<code>Godep.json</code> というJSONファイルが生成される。<br />
このJSONが、mavenでいうpom.xml、npmでいうpackage.json にあたるもので、基本手動でいじらない。<br />
この<code>Godep.json</code> はGitのバージョン管理対象にするが、<code>_workspace</code> ディレクトリは.gitignoreに追記しておく。</p>

<p>Godep.json に更新があった場合、他のメンバーは、</p>

<pre><code>godep restore
</code></pre>

<p>で同じパッケージの同じバージョンを GOPATH配下に配置できる。<br />
これは捗る！</p>

<p>ここで言う、他のメンバーとは、Travis等のCIツールも含まれる。<br />
ちなみに、Godepは<a href="http://docs.travis-ci.com/user/languages/go/">Travisが対応している</a>ので、Goをビルドする時にちょっと楽。</p>

<h3 id="まとめ">まとめ</h3>

<p>Java = maven + pom.xml<br />
Node = npm + package.json<br />
Golang = Godep + Godep.json<br />
で今のところいいのでは。</p>

<p>Goには、依存パッケージを取得する仕組みはあるが、依存の列挙、バージョンを管理する仕組みはない。<br />
なので、別途Godepなどのツールで管理しとかないとチーム開発やCIは辛いかも。</p>

			</section>
		</article>
	</main>


	<footer role="contentinfo">
		<div class="hr"></div>
		<div class="row">
			<div class="footer-link">
				
				<a href="https://github.com/takecy/" title="github"><span class="octicon octicon-mark-github"></span></a>
				<a href="https://twitter.com/takkecy" title="github"><span class="fs1" data-icon="&#xe094;"></span></a>
			</div>
		</div>
		<div class="row">
			<div class="copyright">&copy; takecy 2018</div>
			<div class="poweredby">by <a href="https://gohugo.io/">Hugo</a></div>
		</div>
	</footer>

</div>



<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>

